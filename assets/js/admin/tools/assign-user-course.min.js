import TomSelect from"tom-select";import{lpFetchAPI}from"../../utils.js";import Api from"../../api.js";export default function assignUserCourse(){let e;const t=(e,t,s)=>{const o=Api.admin.apiSearchCourses,n={headers:{"Content-Type":"application/json","X-WP-Nonce":lpDataAdmin.nonce},method:"POST",body:JSON.stringify({c_search:e})};lpFetchAPI(o,n,{success:e=>{const o=e.data.map((e=>({value:e.ID,text:e.post_title+`(#${e.ID})`})));"function"==typeof t&&("setupOptions"===t.name?s.setupOptions(o):t(o))}})},s=(e,t,s)=>{const o=Api.admin.apiSearchUsers,n={headers:{"Content-Type":"application/json","X-WP-Nonce":lpDataAdmin.nonce},method:"POST",body:JSON.stringify({search:e})};lpFetchAPI(o,n,{success:e=>{const o=e.data.map((e=>({value:e.ID,text:`${e.display_name} (#${e.ID}) - ${e.user_email}`})));"function"==typeof t&&("setupOptions"===t.name?s.setupOptions(o):t(o))}})};document.addEventListener("DOMContentLoaded",(()=>{e=document.querySelector("#lp-assign-user-course-form"),e&&(e.addEventListener("submit",(e=>{console.log("submit"),e.preventDefault();const t=new FormData(e.target),s=Object.fromEntries(Array.from(t.keys(),(e=>{const s=t.getAll(e);return[e,s.length>1?s:s.pop()]})));console.log("OBJ",s);let o=[],n=[];"string"==typeof s.course_ids?o.push(s.course_ids):"object"==typeof s.course_ids&&(o=s.course_ids),"string"==typeof s.user_ids?n.push(s.user_ids):"object"==typeof s.user_ids&&(n=s.user_ids),console.log(n,o);const i=[];o.map(((e,t)=>{const s={};s.course_id=e,n.map(((e,t)=>{const o={...s,user_id:e};i.push(o)}))})),console.log("Packages: ",i);const c=i.slice(0,5),r={headers:{"Content-Type":"application/json","X-WP-Nonce":lpDataAdmin.nonce},method:"POST",body:JSON.stringify({data:c})};lpFetchAPI(Api.admin.apiAssignUserCourse,r,{success:e=>{console.log(e)}})})),(()=>{const s=e.querySelector("[name=course_ids]");if(!s)return;const o=new TomSelect(s,{maxItems:5,options:[],plugins:{remove_button:{title:"Remove this item"}},load(e,s){t(e,s)}});t("",o.setupOptions,o)})(),(()=>{const t=e.querySelector("[name=user_ids]");if(!t)return;const o=new TomSelect(t,{maxItems:5,options:[],plugins:{remove_button:{title:"Remove this item"}},load(e,t){s(e,t)}});s("",o.setupOptions,o)})())}))}